<Window x:Class="BOOK_SCRIBBLE_PROJECT.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:views="clr-namespace:BOOK_SCRIBBLE_PROJECT.Views"
        xmlns:viewmodels="clr-namespace:BOOK_SCRIBBLE_PROJECT.ViewModels"
        xmlns:converters="clr-namespace:BOOK_SCRIBBLE_PROJECT.Converters"
        mc:Ignorable="d"
        Title="MainWindow" Height="875" Width="500"
        FontFamily="Noto Sans KR"
        Loaded="MainWindow_Loaded">

    <Window.DataContext>
        <viewmodels:MainViewModel/>
    </Window.DataContext>

    <Window.Resources>
        <DataTemplate DataType="{x:Type viewmodels:BookShelfViewModel}">
            <views:BookShelfBackgroundView/>
        </DataTemplate>
        <DataTemplate DataType="{x:Type viewmodels:BookDetailViewModel}">
            <views:BookDetailView/>
        </DataTemplate>
        <DataTemplate DataType="{x:Type viewmodels:CreateBookViewModel}">
            <views:CreateBookView/>
        </DataTemplate>
        <converters:TypeToVisibilityConverter x:Key="TypeToVisibilityConverter" />
        <converters:EmptyCollectionToVisibilityConverter x:Key="EmptyCollectionToVisibilityConverter" />
    </Window.Resources>

    <Grid>
        <Grid Background="#FFF2CC">
            <Grid.RowDefinitions>
                <RowDefinition Height="46"/>
                <RowDefinition Height="26"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <StackPanel Grid.Row="0" Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,10,0,10" Grid.RowSpan="2">
                <Image Source="/Assets/CHARACTER.png" Width="40" Height="40" RenderOptions.BitmapScalingMode="HighQuality"/>
                <Image Source="/Assets/TITLE.png" Height="52" Width="100"/>
            </StackPanel>

            <Grid Grid.Row="2">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <Border Grid.Column="0" CornerRadius="10" Background="#FFFFFF" BorderBrush="#000" BorderThickness="1" Margin="20,10,32,10" Panel.ZIndex="1">
                    <Border.Effect>
                        <DropShadowEffect ShadowDepth="5" Opacity="0.3" BlurRadius="5"/>
                    </Border.Effect>
                </Border>

                <StackPanel Grid.Column="1" Orientation="Vertical" HorizontalAlignment="Right" Margin="-50,60,10,10" Panel.ZIndex="2">
                    <ToggleButton Content="도서목록" Style="{StaticResource TabButtonStyle}" IsChecked="{Binding IsBookShelfSelected, Mode=TwoWay}" Command="{Binding NavigateToBookShelfCommand}"/>
                    <ToggleButton Content="도서타워" Style="{StaticResource TabButtonStyle}" IsChecked="{Binding IsBookTowerSelected, Mode=TwoWay}" Command="{Binding NavigateToBookTowerCommand}"/>
                </StackPanel>

                <Border Grid.Column="0" Margin="10,0,40,20" CornerRadius="10" Background="#EEFACF" BorderBrush="#000" BorderThickness="1"
                        RenderTransformOrigin="0.5,0.5" Panel.ZIndex="3">
                    <Border.RenderTransform>
                        <TransformGroup>
                            <ScaleTransform/>
                            <SkewTransform AngleY="0.178" AngleX="0.025"/>
                            <RotateTransform/>
                            <TranslateTransform Y="0.748" X="0.171"/>
                        </TransformGroup>
                    </Border.RenderTransform>
                    <Border.LayoutTransform>
                        <TranslateTransform X="-5" Y="-5"/>
                    </Border.LayoutTransform>
                </Border>

                <Border Grid.Column="0" CornerRadius="10" Background="Transparent" Margin="20,10,32,10" Panel.ZIndex="4">
                    <ScrollViewer VerticalScrollBarVisibility="Disabled" Margin="0,0,18,20">
                        <Grid>
                            <!-- 배경 프레임: 북목록(BookShelf)일 때만 보이도록 숨김/표시 -->
                            <Border BorderBrush="#000" BorderThickness="1">
                                <Border.Style>
                                    <Style TargetType="Border">
                                        <Setter Property="Visibility" Value="Visible" />
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding CurrentViewModel, Converter={StaticResource TypeToVisibilityConverter}}" Value="Hidden">
                                                <Setter Property="Visibility" Value="Hidden" />
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </Border.Style>
                            </Border>

                            <!-- 실제 화면 컨텐츠: ✅ 항상 보이게 별도로 둔다 -->
                            <ContentControl Content="{Binding CurrentViewModel}"
                             Width="430" Height="747" HorizontalAlignment="Center" />
                        </Grid>
                    </ScrollViewer>
                </Border>
            </Grid>
        </Grid>

        <views:PageLoading x:Name="LoadingOverlay" Panel.ZIndex="10"/>
    </Grid>
</Window>